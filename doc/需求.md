# Fin-Pilot 需求文档（完整版）

## 1. 产品概述

Fin-Pilot 是面向个人投资者的多资产投资组合管理工具，支持多用户、多组合管理。核心功能包括：

* 实时跟踪组合表现（分钟级刷新）
* 支持 A股基金、美股基金、债券和加密货币
* 多币种资产（人民币、美元）折算
* 自动推荐买入/卖出操作
* 历史记录、可视化分析与邮件提醒

产品目标：帮助用户有效管理投资组合，优化资产配置，并提供可操作的建议与风险控制。

---

## 2. 功能模块

### A. 用户管理

* **注册 / 登录 / 登出**
* 用户信息管理：邮箱、密码、通知偏好
* 多用户独立组合管理
* 权限控制：用户只能访问自己的组合与资产

**逻辑：**

* 注册时验证邮箱唯一性
* 登录成功后加载用户所有组合及偏好
* API接口验证用户身份，确保数据安全

---

### B. 投资组合管理

* **创建 / 删除组合**
* **配置组合目标**：资产类型比例、风险等级
* **导入 / 同步资产**：通过第三方接口拉取市场数据
* **资产操作**：买入、卖出、记录分红/费用
* **查看历史交易记录**

**逻辑：**

* 创建组合时设定名称、目标比例、币种
* 每个组合维护资产列表，每个资产包含：类型、币种、数量、成本价、当前价格、净值
* 历史交易记录每笔操作：时间、类型、数量、价格、手续费
* 支持多组合、多用户操作

---

### C. 数据获取与同步

* **定时任务**
- 从第三方接口获取各市场资产行情 （每日）
- 从第三方接口获取多交易所、多资产标的信息（每日）
- 接口文档见`/doc/Third part api.md`


* **更新内容**：价格、交易状态、分红、币种汇率

* **同步逻辑**：

  1. 拉取最新数据 → 对比已有资产 → 更新价格与净值
  2. 记录更新日志
  3. 如果资产属于组合 → 更新组合净值和占比

* **用户资产管理**：

  * 可搜索接口提供的资产并添加到组合
  * 支持手动输入资产并手动维护价格、数量、币种
  * 系统同步不覆盖用户手动输入字段

* **多币种处理**：

  * 组合净值统一折算为基础币种（用户选择人民币或美元）
  * 实时汇率由接口提供

* **数据一致性**：

  * 系统同步只更新价格、净值、交易状态
  * 用户手动修改优先，不被同步覆盖
  * 所有操作（同步或手动）记录历史

---

### D. 分析与可视化

* 实时计算组合净值、收益率
* 按资产类型、币种、时间维度统计分析
* 可视化展示：

  * 折线图：收益曲线
  * 饼图：资产分布
  * 柱状图：分类收益对比
* 支持时间区间选择与资产筛选

---

### E. 推荐操作

* **生成买入/卖出建议**
* **逻辑**：

  1. 计算组合各资产占比
  2. 与目标比例比较
  3. 偏离目标的资产生成操作建议：

     * 偏低 → 推荐买入
     * 偏高 → 推荐卖出
* 用户可自定义目标比例与偏离阈值
* 推荐结果实时更新，可直接操作执行

---

### F. 通知与提醒

* 邮件提醒：

  * 组合偏离目标比例
  * 资产价格波动
* 用户自定义阈值
* 系统每分钟检查并触发提醒

---

### G. 系统与安全

* 用户数据隔离、权限控制
* API接口权限验证
* 操作日志记录（用户、时间、操作类型、资产）

---

## 3. 数据结构概览

* **User**

  * id, email, password_hash, preferences (通知阈值、基础币种、显示偏好)

* **Portfolio**

  * id, user_id, name, target_allocation (资产类型比例、币种比例), risk_level, created_at

* **Asset**

  * id, portfolio_id, name, type (A股基金/美股基金/债券/加密货币), currency, quantity, cost_price, current_price, net_value, source (系统同步/手动输入)

* **Transaction**

  * id, asset_id, type (buy/sell/dividend/fee), quantity, price, fee, timestamp

* **Recommendation**

  * id, portfolio_id, asset_id, suggested_action, suggested_quantity, timestamp

* **Notification**

  * id, user_id, type (ratio_deviation / price_alert), triggered_value, timestamp, read_status

* **SyncLog**

  * id, asset_id, old_price, new_price, timestamp, source (接口同步)

---

## 4. 用户操作流程

1. **注册 → 登录**
2. **创建组合 → 配置目标比例**
3. **添加资产**：

   * 搜索接口资产 → 添加
   * 手动输入资产 → 添加
4. **系统定时同步资产价格 → 更新组合净值**
5. **用户查看组合分析**：

   * 净值、收益率、资产分布、趋势图表
6. **推荐操作**：

   * 系统生成买入/卖出建议 → 用户执行
7. **通知提醒**：

   * 邮件发送偏离目标或价格波动信息
8. **历史查询与报表导出**

---

## 5. UI页面概览

1. **登录/注册**：邮箱、密码输入框，登录/注册按钮
2. **首页/组合总览**：顶部导航栏、左侧组合列表、组合概览、近期交易表、快捷操作按钮
3. **组合详情**：左侧菜单（概览/分析/历史交易/推荐操作）、资产分布饼图、收益曲线、分类对比柱状图、推荐操作列表
4. **资产管理**：搜索框、资产表格、批量操作按钮、手动添加表单
5. **设置/通知**：用户信息编辑、邮件提醒阈值设置、保存按钮
6. **报表/可视化**：日期选择器、折线图/饼图/柱状图、导出按钮

---

## 6. 系统逻辑总结

* **资产数据流**：

  * 系统定时同步 → 更新资产价格 → 更新组合净值 → 更新推荐操作
  * 用户手动输入或修改资产 → 优先覆盖价格/数量 → 更新组合净值
* **推荐操作流**：

  * 当前占比 vs 目标占比 → 偏离计算 → 生成买入/卖出建议 → 用户执行
* **通知流**：

  * 每分钟检查组合偏离、价格波动 → 超阈值触发邮件提醒
